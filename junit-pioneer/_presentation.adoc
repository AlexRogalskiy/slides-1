= To Jupiter And Beyond
:backend: revealjs
:revealjs_theme: nipa-night
:revealjsdir: ../_reveal.js
:revealjs_controls: false
:revealjs_progress: false
:revealjs_slideNumber: false
:revealjs_history: true
:revealjs_center: true
:revealjs_transition: fade
:revealjs_backgroundTransition: fade
:revealjs_parallaxBackgroundImage: images/helmet.jpg
:revealjs_parallaxBackgroundSize: 6000px 4000px
:docinfo: shared
:docinfodir: ../_shared

:imagedir: images

include::../_shared/highlight.js.adoc[]

++++
<style>
.reveal .title h2 {
	font-size: 1.75em;
}
</style>
<h2>On An Exploratory Mission With JUnit Pioneer</h2>
++++

:host-name: Global Summit for Java Devs
:host-url: https://java.geekle.us/
:host-logo-url: images/logo-java-summit-2021.png
// :host-logo-style: background-color: #FFF; border-color: #FFF;
:host-twitter-name: @GeekleOfficial
:host-twitter-url: https://twitter.com/GeekleOfficial
include::../_shared/event-on-title-and-footer.adoc[]

// ######### //
// I N T R O //
// ######### //

// ‚áù


== JUnit Pioneer

JUnit Pioneer -- https://junit-pioneer.org[junit-pioneer.org]:

* provides extensions for https://github.com/junit-team/junit5/[JUnit 5] and its https://junit.org/junit5/docs/current/user-guide/[Jupiter API]
* small project (5k lines of code, 4 maintainers)

Why is it interesting?

* JUnit 5 is thrilling
* grew a (small) community on Twitch
* neat build and Git practices
* one-click releases
* automatic website build

=== Lots to talk about!

* JUnit 5 and its extension model
* Pioneer's extensions
* Pioneer's mission statement and history
* how live-streaming on Twitch grew a community
* organizational style and contribution guide
* code style, Git practices, release considerations
* how we use Shipkit and GitHub actions for one-click releases
* building the website with Jekyll and GitHub actions

== JUnit Extensions

Crash course to JUnit 5 and +
its extension model.

(This is _very_ incomplete!)

=== JUnit 5

A simple test:

```java
class JUnit5Test {

	@Test
	void test() {
		assertTrue(true);
	}

}
```

* need an API to write tests against
* need an engine that executes them

=== Separation Of Concerns

Separation of concerns in JUnit 5:

. an API to write tests against
. an API to discover and run tests
[loweralpha]
.. specific engine per variant of tests +
(e.g. JUnit 4 or JUnit 5)
.. orchestration of engines
.. API between them

=== Architecture

image::images/architecture-limited-lean.png[style="diagram", width=550]

=== JUnit Jupiter

* defines test API
* defines extension API
* contains engine for them

Often referred to as "JUnit 5".

=== Extension Model

Jupiter allows seamless extensions:

```java
@Test
@DisabledOnFriday
void failingTest() {
	assertTrue(false);
}
```

Cornerstones:

* extensions interact with _extension points_
* extensions must be registered +
  (possibly with annotations)

=== Extension Points

An incomplete list:

* instance post processor
* `@BeforeAll` and `@BeforeEach`
* execution condition
* exception handling
* `@AfterEach` and `@AfterAll`

Each represented by an interface, +
e.g. `ExecutionCondition`.

=== Extension Example

How to disable tests on Friday:

```java
public class DisabledOnFridayCondition
		implements ExecutionCondition {

	@Override
	public ConditionEvaluationResult evaluate(/**/) {
		if (isFriday())
			return ConditionEvaluationResult
				.disabled("Weekend! üï∫üèæüíÉüèº");
		else
			return ConditionEvaluationResult
				.enabled("Run the test üò¨");
	}

}
```

=== Registering Annotations

Jupiter is aware of https://en.wikibooks.org/wiki/Java_Programming/Annotations/Meta-Annotations[meta annotations]. +
‚áù We can create our own annotations!

```java
// [... more annotations ...]
@ExtendWith(DisabledOnFridayCondition.class)
public @interface DisabledOnFriday { }

@Test
@DisabledOnFriday
void failingTest() {
	assertTrue(false);
}
```


== Pioneer Extensions

An incomplete list:

* Cartesian products for parameters
* set default locale
* set system properties
* publish issue information
* retry failed tests

Let's see some incomplete examples!

=== Cartesian Product

```java
@CartesianProductTest
@CartesianValueSource(ints = { 1, 2 })
@CartesianValueSource(strings = { "A", "B" })
void test(int number, String character) {
    // called four times - with:
	// (1, "A") (1, "B") (2, "A") (2, "B")
}
```

=== Default Locale

```java
@Test
@DefaultLocale(language = "en")
void test() {
    assertThat(Locale.getDefault())
        .isEqualTo(new Locale("en"));
}
```

=== System Properties

```java
@Test
@ClearSystemProperty(key = "user.name")
@SetSystemProperty(key = "user.dir", value = "...")
void test() {
    assertThat(System.getProperty("user.name"))
		.isNull();
    assertThat(System.getProperty("user.dir"))
		.isEqualTo("...");
}
```

=== Issue Information

Mark tests that belong to issues:

```java
@Test
@Issue("REQ-123")
void test() {
    // a test for the issue "REQ-123"
}
```

Process information after execution:

// https://yuml.me/nipafx/edit/junit-pioneer-issue-test-suite
image::images/issue-test-suite.png[role="diagram"]

=== Retrying Tests

```java
@RetryingTest(3)
void test() {
    // if 1st, 2nd, or 3rd execution passes,
	// the test passes; otherwise fails
}
```

=== Others

We have a few more:

* ranges for parameters
* set default time zone
* set environment variables
* disable specific parameterized tests
* publish report entries
* mocking standard I/O

Isn't this all a bit random?

‚áù Yes!


== JUnit Pioneer

Mission statement:

> JUnit Pioneer provides extensions for JUnit 5 and its Jupiter API.
> It does not limit itself to proven ideas with wide application but is purposely open to experiments.
> It aims to spin off successful and cohesive portions into sibling projects or back into the JUnit 5 code base.

=== JUnit Pioneer

We want to:

* provide helpful extensions
* be open to experimental ideas
* catch-all extensions that are too small +
  to be their own project

=== JUnit Pioneer

We are/have:

* four maintainers
* a dozen contributors
* 4.7k lines of production code
* 5.9k lines of test code
* 26 releases, 5 since 1.0.0

// TODO: more meaningful stats?

=== How did we get here?

Sounds good? Not so fast!

* this is a hobby project
* life gets in the way
* for 3 years, little happened


[state="empty",background-color="#161b22"]
=== !
image::images/contributions.png[background, size=contain]

=== Experimentation

2016: ::
* JUnit 5 publishes first milestone builds
* Nicolai launches _JUnit Io_ for his +
  experiments with the extension API

> A melting pot for all kinds of extensions

Just a demo repo, no releases: +
‚áù 18 commits, 1.3k LOC, 300 LOX

// LOC 1348 / total 1647

=== Excitement

2017: ::
* JUnit 5 publishes release candidates +
  and in September 5.0.0
* https://github.com/smoyer64[Steve Moyer] plans to roll his own +
  experiments into a project
* Nicolai and Steve join forces and +
  rebrand _JUnit Io_ to _JUnit Pioneer_ +
  (first space craft to Jupiter)

Turning it into an actual project: +
‚áù 19 commits, -12 LOC ü§î, 430 LOX, 0 releases

// LOC 1336 / total 2077

=== üò¥

September 2017 to April 2018: ::

* Steve is busy teaching
* Nicolai always has more projects than time

‚áù 0 commits, 0 LOC/X, 0 releases

=== Takeoff

May to November 2018: ::

* JUnit 5 team helps Nicolai
* Pioneer lifts off the ground

‚áù 31 commits,
870 LOC, 450 LOX, +
4 contributors,
4 releases

// LOC 2202 / total 3396

=== üò¥üò¥

November 2018 to September 2019: ::
again, life gets in the way

‚áù 0 commits, 0 LOC/X, 0 releases

=== Cruise control

October 2019 to today: ::

* JUnit 5 team gives ultimatum
* magic happens üßô‚Äç‚ôÄÔ∏èü¶Ñ‚ú®
* Pioneer flies at steady pace

‚áù ~150 commits,
8.4k LOC, 1.9k LOX, +
3 maintainers, 15 contributors, +
22 releases

// end of March 2021:
// LOC 10.6k / total 13.7k

=== Wait, Magic?

[state="empty",background-color="#3B3C3F"]
=== !
image::images/stream-coding.png[background, size=contain]

[state="empty",background-color="#3B3C3F"]
=== !
image::images/stream-troubles.png[background, size=contain]

[state="empty",background-color="black"]
=== !
image::images/stream-issues.png[background, size=contain]

[state="empty",background-color="black"]
=== !
image::images/stream-troubles-2.png[background, size=contain]

[state="empty",background-color="#252429"]
=== !
image::images/stream-helmet-2.png[background, size=contain]

[state="empty",background-color="#252429"]
=== !
image::images/stream-pioneer-glasses.png[background, size=contain]

[state="empty",background-color="#252429"]
=== !
image::images/stream-garland.png[background, size=contain]

=== Twitch

2019::
* Nicolai discovers Twitch
* does a few live streams in spring
* decides to stream regularly in December

2020::
* 30 JUnit Pioneer streams
* usually 3 to 5 hours

=== Twitch

Expected effects:

* commits Nicolai to ~10 h/month for Pioneer
* interests Java devs

=== Twitch

Unexpected effects:

* gives viewers insight into project
* viewers help in their areas of expertise
** in Twitch chat
** in GitHub
* viewers pick up small issues
* viewers become contributors
* contributors become maintainers

// TODO Twitch summary?


include::../_shared/about-slide.adoc[]

include::images/sources.adoc[]
